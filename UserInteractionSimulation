from modsim import *
from Timing import Timing
from LogManager import LogManager
from TaskCompletionManager import TaskCompletionManager
from ApplicationInstanceManagement import ApplicationInstanceManagement
from MouseMovementSimulator import MouseMovementManager
from KeyboardSimulation import KeyboardManager
import random
import numpy as np


# BUFFER MANAGEMENT
ARRAY_SIZE = 16

# CONTROL PARAMETER
runs = 1

maxInstanceExplorer = int(np.random.exponential(scale=1.2))+1
maxInstanceCalculator = int(np.random.exponential(scale=1.2))+1
maxInstanceNotepad = int(np.random.exponential(scale=1.2))+1

global_mouseprecision = 0.98    # the higher the better
global_hotkeyusage = 0.5        # 1.0 == always keys
global_appclosing = 1.0         # 1 means always closing
global_minimize = 0.9           # if app stays open, user tends to minimize?
global_keyprecision = 0.98      # the higher the more precise
global_openOrReopen = 0.0       # chance of OPENING over REOPENING
global_reactivity = 1.0         # 0 = fast, 1 = slow
global_repetition = 0.05        # 0 = no task repetition, 1 = max probability of repeating tasks
global_sequential = 0.5         # lambda parameter of exponential function to select tasks
global_search = 0.0             # 0 no search, 1 often search



if __name__ == '__main__':

    def taskZero():
        ## DECIDE ON OPENING OR REOPENING EXPLORER
        openExOReopenEx = 0
        if appManager.isAnyExplorerRunning():
            if appManager.possibleToOpenNewExplorer():
                if random.random() < global_openOrReopen:
                    openExOReopenEx = -1
                else:
                    openExOReopenEx = 1
            else:
                openExOReopenEx = 1
        else:
            openExOReopenEx = -1

        if openExOReopenEx == -1:
            explorerId = appManager.getInstance(application="explorer", purpose="open")

            ## DECIDE HOW TO OPEN EXPLORER
            # -1 = MousePos (1,1) + Click
            # 0 = Click + TEXT (2- 13 letters) + Enter
            # 1 = WIN Key + Text (2-13 letters) + Enter

            decision = 0
            if random.random() < global_hotkeyusage:
                if random.random() < global_hotkeyusage:
                    decision = 1
                else:
                    decision = 0
            else:
                if random.random() < (1.0 - global_hotkeyusage):
                    decision = -1
                else:
                    decision = 0
        else:
            explorerId = appManager.getInstance(application="explorer", purpose="reopen", param="documents/summary")
            decision = 0
            if appManager.explorerStates[explorerId] != 1:
                if random.random() < global_hotkeyusage:
                    decision = 1
                else:
                    decision = -1

        if (openExOReopenEx == -1 and decision == -1):
            mouse.move(target_x=1, target_y=1)
            mouse.click()
            appManager.control(application="explorer", instance=explorerId, control=1)
        elif (openExOReopenEx == -1 and decision == 0):
            mouse.move(target_x=1, target_y=1)
            mouse.click()
            keyboard.write("this")
            mouse.move(target_x=1, target_y=2)
            mouse.click()
            appManager.control(application="explorer", instance=explorerId, control=1)
        elif (openExOReopenEx == -1 and decision == 1):
            keyboard.write("#3675#")
            keyboard.write("this")
            keyboard.write("#28#")
            appManager.control(application="explorer", instance=explorerId, control=1)
        elif (openExOReopenEx == 1 and decision == 1):
            keyboard.write("#56#")
            keyboard.write("#15#")
            appManager.control(application="explorer", instance=explorerId, control=4)
        elif (openExOReopenEx == 1 and decision == -1):
            mouse.move(1,2)
            mouse.click()
            appManager.control(application="explorer", instance=explorerId, control=4)


        ## Change directory to documents/summary
        if (appManager.explorerPaths[explorerId] == "documents/2017"):
            decision = 0
            if random.random() < global_hotkeyusage:
                if random.random() < global_hotkeyusage:
                    decision = 1
                else:
                    decision = 0
            else:
                if random.random() < (1.0 - global_hotkeyusage):
                    decision = -1
                else:
                    decision = 0

            mouse.move(1, 2)
            if(decision == 1):
                mouse.doubleclick()
            elif(decision == 0):
                mouse.click()
                keyboard.write("#28#")
            elif(decision == -1):
                keyboard.write("#14#")
            appManager.updatePath(explorerId, "documents/")

        ## Change directory to documents
        if (appManager.explorerPaths[explorerId] == "MAIN"):
            decision = 0
            if random.random() < global_hotkeyusage:
                if random.random() < global_hotkeyusage:
                    decision = 1
                else:
                    decision = 0
            else:
                if random.random() < (1.0 - global_hotkeyusage):
                    decision = -1
                else:
                    decision = 0

            mouse.move(2, 2)
            if(decision == 1):
                mouse.doubleclick()
            elif(decision == 0):
                mouse.click()
                keyboard.write("#28#")
            elif(decision == -1):
                mouse.click()
                keyboard.write("documents/")
                keyboard.write("#28#")
            appManager.updatePath(explorerId, "documents/")


        ## Change directory to documents/summary
        if (appManager.explorerPaths[explorerId] == "documents/"):
            decision = 0
            if random.random() < global_hotkeyusage:
                if random.random() < global_hotkeyusage:
                    decision = 1
                else:
                    decision = 0
            else:
                if random.random() < (1.0 - global_hotkeyusage):
                    decision = -1
                else:
                    decision = 0

            mouse.move(2, 2)
            if(decision == 1):
                mouse.doubleclick()
            elif(decision == 0):
                mouse.click()
                keyboard.write("#28#")
            elif(decision == -1):
                mouse.click()
                keyboard.write("summary")
                keyboard.write("#28#")
            appManager.updatePath(explorerId, "documents/summary")


        ## Create Summary File
        if (appManager.explorerPaths[explorerId] == "documents/summary"):
            mouse.move(3,3)
            mouse.rightclick()
            mouse.move(3,2)
            mouse.click()

            if random.random() < global_reactivity:
                keyboard.write("summary.txt")
                keyboard.write("#28#")
            else:
                mouse.click()
                mouse.click()
                mouse.click()
                keyboard.write("#14#")
                keyboard.write("summary.txt")
                keyboard.write("#28#")

        # DECIDE TO CLOSE OR NOT TO CLOSE?
        if random.random() < global_appclosing:
            ## CLOSE APP
            if random.random() < global_hotkeyusage:
                ## ALT + F4
                keyboard.write("#56#")
                keyboard.write("#62#")
            else:
                ## Ueber clicks
                mouse.move(4,4)
                mouse.click()
            ## TRIGGER DEN CLOSE IM APP INSTANCE MANAGEMENT
            appManager.control("explorer", explorerId, 0)
        elif random.random() < global_minimize:
            mouse.move(4,4)
            mouse.click()
            appManager.control("explorer", explorerId, 2)

#### ------------------------------------------------------------------>

    def taskOne(forceOpen=False):
            notepadId = ""
            if appManager.isFileOpen("summary.txt"):
                notepadId = appManager.getInstanceByFile("summary.txt")

                # if is minimized --> maximize # if is in background --> to FG
                if appManager.notepadStates[notepadId] == 3 or appManager.notepadStates[notepadId] == 2:
                    if random.random() < global_hotkeyusage:
                        keyboard.write("#56#")
                        keyboard.write("#15#")
                    else:
                        mouse.move(1, 2)
                        mouse.click()
                    appManager.control(application="notepad", instance=notepadId, control=4, param="summary.txt")

            else:
                if random.random() < global_search:
                    if random.random() < global_hotkeyusage:
                        keyboard.write("#3675#")
                        keyboard.write("summary.txt")
                        keyboard.write("#28#")
                        notepadId = appManager.getInstance(application="notepad", purpose="open")
                        appManager.control(application="notepad", instance=notepadId, control=1, param="summary.txt")
                    else:
                        mouse.move(1, 1)
                        mouse.click()
                        keyboard.write("summary.txt")
                        keyboard.write("#28#")
                        notepadId = appManager.getInstance(application="notepad", purpose="open")
                        appManager.control(application="notepad", instance=notepadId, control=1, param="summary.txt")

                else:
                    ## DECIDE ON OPENING OR REOPENING EXPLORER
                    openExOReopenEx = 0
                    if appManager.isAnyExplorerRunning():
                        if appManager.possibleToOpenNewExplorer():
                            if random.random() < global_openOrReopen:
                                openExOReopenEx = -1
                            else:
                                openExOReopenEx = 1
                        else:
                            openExOReopenEx = 1
                    else:
                        openExOReopenEx = -1

                    if openExOReopenEx == -1:
                        explorerId = appManager.getInstance(application="explorer", purpose="open")

                        ## DECIDE HOW TO OPEN EXPLORER
                        # -1 = MousePos (1,1) + Click
                        # 0 = Click + TEXT (2- 13 letters) + Enter
                        # 1 = WIN Key + Text (2-13 letters) + Enter

                        decision = 0
                        if random.random() < global_hotkeyusage:
                            if random.random() < global_hotkeyusage:
                                decision = 1
                            else:
                                decision = 0
                        else:
                            if random.random() < (1.0 - global_hotkeyusage):
                                decision = -1
                            else:
                                decision = 0
                    else:
                        explorerId = appManager.getInstance(application="explorer", purpose="reopen",
                                                            param="documents/summary")
                        decision = 0
                        if appManager.explorerStates[explorerId] != 1:
                            if random.random() < global_hotkeyusage:
                                decision = 1
                            else:
                                decision = -1

                    if (openExOReopenEx == -1 and decision == -1):
                        mouse.move(target_x=1, target_y=1)
                        mouse.click()
                        appManager.control(application="explorer", instance=explorerId, control=1)
                    elif (openExOReopenEx == -1 and decision == 0):
                        mouse.move(target_x=1, target_y=1)
                        mouse.click()
                        keyboard.write("this")
                        mouse.move(target_x=1, target_y=2)
                        mouse.click()
                        appManager.control(application="explorer", instance=explorerId, control=1)
                    elif (openExOReopenEx == -1 and decision == 1):
                        keyboard.write("#3675#")
                        keyboard.write("this")
                        keyboard.write("#28#")
                        appManager.control(application="explorer", instance=explorerId, control=1)
                    elif (openExOReopenEx == 1 and decision == 1):
                        keyboard.write("#56#")
                        keyboard.write("#15#")
                        appManager.control(application="explorer", instance=explorerId, control=4)
                    elif (openExOReopenEx == 1 and decision == -1):
                        mouse.move(1, 2)
                        mouse.click()
                        appManager.control(application="explorer", instance=explorerId, control=4)

                    ## CHECK THE PATHES
                    ## Change directory to documents/summary
                    if (appManager.explorerPaths[explorerId] == "documents/2017"):
                        decision = 0
                        if random.random() < global_hotkeyusage:
                            if random.random() < global_hotkeyusage:
                                decision = 1
                            else:
                                decision = 0
                        else:
                            if random.random() < (1.0 - global_hotkeyusage):
                                decision = -1
                            else:
                                decision = 0

                        mouse.move(1, 2)
                        if (decision == 1):
                            mouse.doubleclick()
                        elif (decision == 0):
                            mouse.click()
                            keyboard.write("#28#")
                        elif (decision == -1):
                            keyboard.write("#14#")
                        appManager.updatePath(explorerId, "documents/")

                    ## Change directory to documents from MAIN
                    if (appManager.explorerPaths[explorerId] == "MAIN"):
                        decision = 0
                        if random.random() < global_hotkeyusage:
                            if random.random() < global_hotkeyusage:
                                decision = 1
                            else:
                                decision = 0
                        else:
                            if random.random() < (1.0 - global_hotkeyusage):
                                decision = -1
                            else:
                                decision = 0

                        mouse.move(2, 2)
                        if (decision == 1):
                            mouse.doubleclick()
                        elif (decision == 0):
                            mouse.click()
                            keyboard.write("#28#")
                        elif (decision == -1):
                            mouse.click()
                            keyboard.write("documents/")
                            keyboard.write("#28#")
                        appManager.updatePath(explorerId, "documents/")

                    ## Change directory to documents/summary
                    if (appManager.explorerPaths[explorerId] == "documents/"):
                        decision = 0
                        if random.random() < global_hotkeyusage:
                            if random.random() < global_hotkeyusage:
                                decision = 1
                            else:
                                decision = 0
                        else:
                            if random.random() < (1.0 - global_hotkeyusage):
                                decision = -1
                            else:
                                decision = 0

                        mouse.move(2, 2)
                        if (decision == 1):
                            mouse.doubleclick()
                        elif (decision == 0):
                            mouse.click()
                            keyboard.write("#28#")
                        elif (decision == -1):
                            mouse.click()
                            keyboard.write("summary")
                            keyboard.write("#28#")
                        appManager.updatePath(explorerId, "documents/summary")

                        ## Open Q1 FILE
                        decision = 0
                        if random.random() < global_hotkeyusage:
                            mouse.move(3, 3)
                            mouse.click()
                            keyboard.write("#28#")
                        else:
                            mouse.move(3, 3)
                            mouse.doubleclick()
                        notepadId = appManager.getInstance(application="notepad", purpose="open")
                        appManager.control(application="notepad", instance=notepadId, control=1, param="summary.txt")

            readTime = np.random.normal(3.0 + (global_reactivity * 10), 0.7)
            time.delay(readTime)

            if (forceOpen == False):
                ### CLOSING and MINIMIZE FEATURES
                decide_close = 0
                decide_minimize = 0
                if random.random() < global_appclosing:
                    decide_close = 1

                if decide_close == 0 and random.random() < global_minimize:
                    decide_minimize = 1

                if decide_close == 1:
                    if random.random() < global_hotkeyusage:
                        keyboard.write("#56#")
                        keyboard.write("#62#")
                    else:
                        mouse.move(4,4)
                        mouse.click()
                    appManager.control(application="notepad", instance=notepadId, control=0, param="summary.txt")

                if decide_minimize == 1:
                    mouse.move(4,4)
                    mouse.click()
                    appManager.control(application="notepad", instance=notepadId, control=2, param="summary.txt")
            return notepadId


#### ------------------------------------------------------------------>

    def taskTwo(forceOpen = False):
        if appManager.isFileOpen("Q1.txt"):
            notepadId = appManager.getInstanceByFile("Q1.txt")

            # if is minimized --> maximize # if is in background --> to FG
            if appManager.notepadStates[notepadId] == 3 or appManager.notepadStates[notepadId] == 2:
                if random.random() < global_hotkeyusage:
                    keyboard.write("#56#")
                    keyboard.write("#15#")
                else:
                    mouse.move(1,2)
                    mouse.click()
                appManager.control(application="notepad", instance=notepadId, control=4, param="Q1.txt")

        else:
            if random.random() < global_search:
                print("Use FileSearch")
                if random.random() < global_hotkeyusage:
                    keyboard.write("#3675#")
                    keyboard.write("#42#")
                    keyboard.write("Q1")
                    keyboard.write("#28#")
                    notepadId = appManager.getInstance(application="notepad", purpose="open")
                    appManager.control(application="notepad", instance=notepadId, control=1, param="Q1.txt")
                else:
                    mouse.move(1,1)
                    mouse.click()
                    keyboard.write("#42#")
                    keyboard.write("Q1")
                    keyboard.write("#28#")
                    notepadId = appManager.getInstance(application="notepad", purpose="open")
                    appManager.control(application="notepad", instance=notepadId, control=1, param="Q1.txt")


            else:
                ## DECIDE ON OPENING OR REOPENING EXPLORER
                openExOReopenEx = 0
                if appManager.isAnyExplorerRunning():
                    if appManager.possibleToOpenNewExplorer():
                        if random.random() < global_openOrReopen:
                            openExOReopenEx = -1
                        else:
                            openExOReopenEx = 1
                    else:
                        openExOReopenEx = 1
                else:
                    openExOReopenEx = -1

                if openExOReopenEx == -1:
                    explorerId = appManager.getInstance(application="explorer", purpose="open")

                    ## DECIDE HOW TO OPEN EXPLORER
                    # -1 = MousePos (1,1) + Click
                    # 0 = Click + TEXT (2- 13 letters) + Enter
                    # 1 = WIN Key + Text (2-13 letters) + Enter

                    decision = 0
                    if random.random() < global_hotkeyusage:
                        if random.random() < global_hotkeyusage:
                            decision = 1
                        else:
                            decision = 0
                    else:
                        if random.random() < (1.0 - global_hotkeyusage):
                            decision = -1
                        else:
                            decision = 0
                else:
                    explorerId = appManager.getInstance(application="explorer", purpose="reopen", param="documents/2017")
                    decision = 0
                    if appManager.explorerStates[explorerId] != 1:
                        if random.random() < global_hotkeyusage:
                            decision = 1
                        else:
                            decision = -1

                if (openExOReopenEx == -1 and decision == -1):
                    mouse.move(target_x=1, target_y=1)
                    mouse.click()
                    appManager.control(application="explorer", instance=explorerId, control=1)
                elif (openExOReopenEx == -1 and decision == 0):
                    mouse.move(target_x=1, target_y=1)
                    mouse.click()
                    keyboard.write("this")
                    mouse.move(target_x=1, target_y=2)
                    mouse.click()
                    appManager.control(application="explorer", instance=explorerId, control=1)
                elif (openExOReopenEx == -1 and decision == 1):
                    keyboard.write("#3675#")
                    keyboard.write("this")
                    keyboard.write("#28#")
                    appManager.control(application="explorer", instance=explorerId, control=1)
                elif (openExOReopenEx == 1 and decision == 1):
                    keyboard.write("#56#")
                    keyboard.write("#15#")
                    appManager.control(application="explorer", instance=explorerId, control=4)
                elif (openExOReopenEx == 1 and decision == -1):
                    mouse.move(1, 2)
                    mouse.click()
                    appManager.control(application="explorer", instance=explorerId, control=4)


                ## CHECK THE PATHES
                ## Change directory to documents/summary
                if (appManager.explorerPaths[explorerId] == "documents/summary"):
                    decision = 0
                    if random.random() < global_hotkeyusage:
                        if random.random() < global_hotkeyusage:
                            decision = 1
                        else:
                            decision = 0
                    else:
                        if random.random() < (1.0 - global_hotkeyusage):
                            decision = -1
                        else:
                            decision = 0

                    mouse.move(1, 2)
                    if (decision == 1):
                        mouse.doubleclick()
                    elif (decision == 0):
                        mouse.click()
                        keyboard.write("#28#")
                    elif (decision == -1):
                        keyboard.write("#14#")
                    appManager.updatePath(explorerId, "documents/")

                ## Change directory to documents from MAIN
                if (appManager.explorerPaths[explorerId] == "MAIN"):
                    decision = 0
                    if random.random() < global_hotkeyusage:
                        if random.random() < global_hotkeyusage:
                            decision = 1
                        else:
                            decision = 0
                    else:
                        if random.random() < (1.0 - global_hotkeyusage):
                            decision = -1
                        else:
                            decision = 0

                    mouse.move(2, 2)
                    if (decision == 1):
                        mouse.doubleclick()
                    elif (decision == 0):
                        mouse.click()
                        keyboard.write("#28#")
                    elif (decision == -1):
                        mouse.click()
                        keyboard.write("documents/")
                        keyboard.write("#28#")
                    appManager.updatePath(explorerId, "documents/")

                ## Change directory to documents/summary
                if (appManager.explorerPaths[explorerId] == "documents/"):
                    decision = 0
                    if random.random() < global_hotkeyusage:
                        if random.random() < global_hotkeyusage:
                            decision = 1
                        else:
                            decision = 0
                    else:
                        if random.random() < (1.0 - global_hotkeyusage):
                            decision = -1
                        else:
                            decision = 0

                    mouse.move(2, 2)
                    if (decision == 1):
                        mouse.doubleclick()
                    elif (decision == 0):
                        mouse.click()
                        keyboard.write("#28#")
                    elif (decision == -1):
                        mouse.click()
                        keyboard.write("2017")
                        keyboard.write("#28#")
                    appManager.updatePath(explorerId, "documents/2017")

                ## Open Q1 FILE
                decision = 0
                if random.random() < global_hotkeyusage:
                    mouse.move(3,3)
                    mouse.click()
                    keyboard.write("#28#")
                else:
                    mouse.move(3,3)
                    mouse.doubleclick()
                notepadId = appManager.getInstance(application="notepad", purpose="open")
                appManager.control(application="notepad", instance=notepadId, control=1, param="Q1.txt")

        readTime = np.random.normal(3.0 + (global_reactivity * 10), 0.7)
        time.delay(readTime)

        if (forceOpen == False):
            ### CLOSING and MINIMIZE FEATURES
            decide_close = 0
            decide_minimize = 0
            if random.random() < global_appclosing:
                decide_close = 1

            if decide_close == 0 and random.random() < global_minimize:
                decide_minimize = 1

            if decide_close == 1:
                if random.random() < global_hotkeyusage:
                    keyboard.write("#56#")
                    keyboard.write("#62#")
                else:
                    mouse.move(4, 4)
                    mouse.click()
                appManager.control(application="notepad", instance=notepadId, control=0, param="Q1.txt")

            if decide_minimize == 1:
                mouse.move(4, 4)
                mouse.click()
                appManager.control(application="notepad", instance=notepadId, control=2, param="Q1.txt")


#### ------------------------------------------------------------------>

    def taskThree(forceOpen=False):
            if appManager.isFileOpen("Q2.txt"):
                notepadId = appManager.getInstanceByFile("Q2.txt")

                # if is minimized --> maximize # if is in background --> to FG
                if appManager.notepadStates[notepadId] == 3 or appManager.notepadStates[notepadId] == 2:
                    if random.random() < global_hotkeyusage:
                        keyboard.write("#56#")
                        keyboard.write("#15#")
                    else:
                        mouse.move(1, 2)
                        mouse.click()
                    appManager.control(application="notepad", instance=notepadId, control=4, param="Q2.txt")

            else:
                if random.random() < global_search:
                    print("Use FileSearch")
                    if random.random() < global_hotkeyusage:
                        keyboard.write("#3675#")
                        keyboard.write("#42#")
                        keyboard.write("Q2")
                        keyboard.write("#28#")
                        notepadId = appManager.getInstance(application="notepad", purpose="open")
                        appManager.control(application="notepad", instance=notepadId, control=1, param="Q2.txt")
                    else:
                        mouse.move(1, 1)
                        mouse.click()
                        keyboard.write("#42#")
                        keyboard.write("Q2")
                        keyboard.write("#28#")
                        notepadId = appManager.getInstance(application="notepad", purpose="open")
                        appManager.control(application="notepad", instance=notepadId, control=1, param="Q2.txt")

                else:
                    ## DECIDE ON OPENING OR REOPENING EXPLORER
                    openExOReopenEx = 0
                    if appManager.isAnyExplorerRunning():
                        if appManager.possibleToOpenNewExplorer():
                            if random.random() < global_openOrReopen:
                                openExOReopenEx = -1
                            else:
                                openExOReopenEx = 1
                        else:
                            openExOReopenEx = 1
                    else:
                        openExOReopenEx = -1

                    if openExOReopenEx == -1:
                        explorerId = appManager.getInstance(application="explorer", purpose="open")

                        ## DECIDE HOW TO OPEN EXPLORER
                        # -1 = MousePos (1,1) + Click
                        # 0 = Click + TEXT (2- 13 letters) + Enter
                        # 1 = WIN Key + Text (2-13 letters) + Enter

                        decision = 0
                        if random.random() < global_hotkeyusage:
                            if random.random() < global_hotkeyusage:
                                decision = 1
                            else:
                                decision = 0
                        else:
                            if random.random() < (1.0 - global_hotkeyusage):
                                decision = -1
                            else:
                                decision = 0
                    else:
                        explorerId = appManager.getInstance(application="explorer", purpose="reopen",
                                                            param="documents/2017")
                        decision = 0
                        if appManager.explorerStates[explorerId] != 1:
                            if random.random() < global_hotkeyusage:
                                decision = 1
                            else:
                                decision = -1

                    if (openExOReopenEx == -1 and decision == -1):
                        mouse.move(target_x=1, target_y=1)
                        mouse.click()
                        appManager.control(application="explorer", instance=explorerId, control=1)
                    elif (openExOReopenEx == -1 and decision == 0):
                        mouse.move(target_x=1, target_y=1)
                        mouse.click()
                        keyboard.write("this")
                        mouse.move(target_x=1, target_y=2)
                        mouse.click()
                        appManager.control(application="explorer", instance=explorerId, control=1)
                    elif (openExOReopenEx == -1 and decision == 1):
                        keyboard.write("#3675#")
                        keyboard.write("this")
                        keyboard.write("#28#")
                        appManager.control(application="explorer", instance=explorerId, control=1)
                    elif (openExOReopenEx == 1 and decision == 1):
                        keyboard.write("#56#")
                        keyboard.write("#15#")
                        appManager.control(application="explorer", instance=explorerId, control=4)
                    elif (openExOReopenEx == 1 and decision == -1):
                        mouse.move(1, 2)
                        mouse.click()
                        appManager.control(application="explorer", instance=explorerId, control=4)

                    ## CHECK THE PATHES
                    ## Change directory to documents/summary
                    if (appManager.explorerPaths[explorerId] == "documents/summary"):
                        decision = 0
                        if random.random() < global_hotkeyusage:
                            if random.random() < global_hotkeyusage:
                                decision = 1
                            else:
                                decision = 0
                        else:
                            if random.random() < (1.0 - global_hotkeyusage):
                                decision = -1
                            else:
                                decision = 0

                        mouse.move(1, 2)
                        if (decision == 1):
                            mouse.doubleclick()
                        elif (decision == 0):
                            mouse.click()
                            keyboard.write("#28#")
                        elif (decision == -1):
                            keyboard.write("#14#")
                        appManager.updatePath(explorerId, "documents/")

                    ## Change directory to documents from MAIN
                    if (appManager.explorerPaths[explorerId] == "MAIN"):
                        decision = 0
                        if random.random() < global_hotkeyusage:
                            if random.random() < global_hotkeyusage:
                                decision = 1
                            else:
                                decision = 0
                        else:
                            if random.random() < (1.0 - global_hotkeyusage):
                                decision = -1
                            else:
                                decision = 0

                        mouse.move(2, 2)
                        if (decision == 1):
                            mouse.doubleclick()
                        elif (decision == 0):
                            mouse.click()
                            keyboard.write("#28#")
                        elif (decision == -1):
                            mouse.click()
                            keyboard.write("documents/")
                            keyboard.write("#28#")
                        appManager.updatePath(explorerId, "documents/")

                    ## Change directory to documents/summary
                    if (appManager.explorerPaths[explorerId] == "documents/"):
                        decision = 0
                        if random.random() < global_hotkeyusage:
                            if random.random() < global_hotkeyusage:
                                decision = 1
                            else:
                                decision = 0
                        else:
                            if random.random() < (1.0 - global_hotkeyusage):
                                decision = -1
                            else:
                                decision = 0

                        mouse.move(2, 2)
                        if (decision == 1):
                            mouse.doubleclick()
                        elif (decision == 0):
                            mouse.click()
                            keyboard.write("#28#")
                        elif (decision == -1):
                            mouse.click()
                            keyboard.write("2017")
                            keyboard.write("#28#")
                        appManager.updatePath(explorerId, "documents/2017")

                    ## Open Q1 FILE
                    decision = 0
                    if random.random() < global_hotkeyusage:
                        mouse.move(3, 3)
                        mouse.click()
                        keyboard.write("#28#")
                    else:
                        mouse.move(3, 3)
                        mouse.doubleclick()
                    notepadId = appManager.getInstance(application="notepad", purpose="open")
                    appManager.control(application="notepad", instance=notepadId, control=1, param="Q2.txt")

            readTime = np.random.normal(3.0 + (global_reactivity * 10), 0.7)
            time.delay(readTime)

            if (forceOpen == False):
                ### CLOSING and MINIMIZE FEATURES
                decide_close = 0
                decide_minimize = 0
                if random.random() < global_appclosing:
                    decide_close = 1

                if decide_close == 0 and random.random() < global_minimize:
                    decide_minimize = 1

                if decide_close == 1:
                    if random.random() < global_hotkeyusage:
                        keyboard.write("#56#")
                        keyboard.write("#62#")
                    else:
                        mouse.move(4, 4)
                        mouse.click()
                    appManager.control(application="notepad", instance=notepadId, control=0, param="Q2.txt")

                if decide_minimize == 1:
                    mouse.move(4, 4)
                    mouse.click()
                    appManager.control(application="notepad", instance=notepadId, control=2, param="Q2.txt")


#### ------------------------------------------------------------------>

    def taskFour(forceOpen=False):
        calcId = appManager.getInstance(application="calculator", purpose="open")

        if random.random() < global_hotkeyusage:
            keyboard.write("#3675#")
            keyboard.write("#calc#")
            keyboard.write("#28#")
            appManager.control(application="calculator", instance=calcId, control=1, param="")
        else:
            mouse.move(1, 2)
            mouse.click()
            appManager.control(application="calculator", instance=calcId, control=1, param="")

        if forceOpen == False:
            if random.random() < global_minimize:
                appManager.control(application="calculator", instance=calcId, control=2, param="")

        return calcId

#### ------------------------------------------------------------------>

    def taskFive():
        taskTwo(forceOpen=True)
        taskThree(forceOpen=True)

        calcId = -1
        if random.random() < global_openOrReopen:
            calcId = taskFour(forceOpen=True)
        else:
            calcId = appManager.getInstance(application="calculator", purpose="reopen")

            ### REOPEN HIER
            if random.random() < global_hotkeyusage:
                keyboard.write("#56#")
                keyboard.write("#15#")
            else:
                mouse.move(1,2)
                mouse.click()
            appManager.control(application="calculator", instance=calcId, control=4)

        ## do the math
        if np.random.exponential(0.25) < global_hotkeyusage:
            keyboard.write("45555+9846=")
        else:
            for i in range(13):
                mouse.click()

        #close or minimize or don't do anything
        decide_close = 0
        decide_minimize = 0
        if random.random() < global_appclosing:
            decide_close = 1

        if decide_close == 0 and random.random() < global_minimize:
            decide_minimize = 1

        if decide_close == 1:
            if random.random() < global_hotkeyusage:
                keyboard.write("#56#")
                keyboard.write("#62#")
            else:
                mouse.move(4, 4)
                mouse.click()
            appManager.control(application="calculator", instance=calcId, control=0)

        if decide_minimize == 1:
            mouse.move(4,4)
            mouse.click()
            appManager.control(application="calculator", instance=calcId, control=2)

#### ------------------------------------------------------------------>

    def taskSix():
        notepadId = ""
        if appManager.isFileOpen("summary.txt"):
            notepadId = appManager.getInstanceByFile("summary.txt")

            # if is minimized --> maximize # if is in background --> to FG
            if appManager.notepadStates[notepadId] == 3 or appManager.notepadStates[notepadId] == 2:
                if random.random() < global_hotkeyusage:
                    keyboard.write("#56#")
                    keyboard.write("#15#")
                else:
                    mouse.move(1, 2)
                    mouse.click()
                appManager.control(application="notepad", instance=notepadId, control=4, param="summary.txt")
        else:
            notepadId = taskOne(forceOpen=True)

        readTime = np.random.normal(3.0 + (global_reactivity * 10), 0.7)
        time.delay(readTime)

        keyboard.write("revenue 45875")
        keyboard.write("expenses 45875")

        if random.random() < global_hotkeyusage:
            keyboard.write("#29#")
            keyboard.write("S")
        else:
            mouse.move(2,4)
            mouse.click()
            mouse.move(2,3)
            mouse.click()

        if random.random() < global_hotkeyusage:
            keyboard.write("#56#")
            keyboard.write("#62#")
        else:
            mouse.move(4,4)
            mouse.click()
            mouse.click()
        appManager.control(application="notepad", instance=notepadId, control=0, param="summary.txt")


#### ------------------------------------------------------------------>


    """ Initialize """
    log = LogManager("userbehaviorlog.csv")
    for run in range(1,runs+1):
        taskManager = TaskCompletionManager(chance_repetition=global_repetition, max_repetition=1,
                                            beta=global_sequential)
        taskManager.taskSequence()

        time = Timing()
        appManager = ApplicationInstanceManagement(timing=time, logmanager=log, ARRAY_SIZE=ARRAY_SIZE, maxInstanceCalculator=maxInstanceCalculator,
                                                   maxInstanceExplorer=maxInstanceExplorer, maxInstanceNotepad=maxInstanceNotepad, case=run)
        mouse = MouseMovementManager(timing=time, logmanager=log, mouse_precision=global_mouseprecision, reactivity=global_reactivity, case=run)
        keyboard = KeyboardManager(timing=time, logmanager=log, keyprecision=global_keyprecision, reactivity=global_reactivity, case=run)

        #if taskManager.current_task == 0:
        #    taskZero()

        #seqs = [0, 1, 3, 4, 2, 6, 5]
        seqs = [0, 1, 2, 3, 4, 5, 6]
        print(taskManager.sequence)
        for task in seqs:  # taskManager.sequence:
            if task == 0:
                taskZero()
            elif task == 1:
                taskOne()
            elif task == 2:
                taskTwo()
            elif task == 3:
                taskThree()
            elif task == 4:
                taskFour()
            elif task == 5:
                taskFive()
            elif task == 6:
                taskSix()

    log.writeToCsv()